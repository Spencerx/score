if(SCORE_USE_SYSTEM_LIBRARIES)
  find_package(Snappy GLOBAL CONFIG)
else()
  set(SNAPPY_BUILD_TESTS OFF)
  set(SNAPPY_BUILD_BENCHMARKS OFF)
  set(SNAPPY_INSTALL OFF)
  set(SNAPPY_BUILD_TESTS OFF CACHE "" INTERNAL)
  set(SNAPPY_BUILD_BENCHMARKS OFF CACHE "" INTERNAL)
  set(SNAPPY_INSTALL OFF CACHE "" INTERNAL)

  set(old_BUILD_SHARED_LIBS ${BUILD_SHARED_LIBS})
  set(BUILD_SHARED_LIBS OFF)

  if(NOT MSVC AND NOT CMAKE_CROSSCOMPILING)
    if(CMAKE_BUILD_TYPE MATCHES ".*Deb.*")
      set(old_CXXFLAGS "${CMAKE_CXX_FLAGS}")
      set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O3 -march=native")
    endif()
  endif()
  add_subdirectory("${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/snappy")

  if(NOT MSVC AND NOT CMAKE_CROSSCOMPILING)
    if(CMAKE_BUILD_TYPE MATCHES ".*Deb.*")
      set(CMAKE_CXX_FLAGS "${old_CXXFLAGS}")
    endif()
  endif()
  set(BUILD_SHARED_LIBS ${old_BUILD_SHARED_LIBS})
endif()
